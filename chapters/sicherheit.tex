\chapter{Sicherheit und Zugriffskontrolle}

\section{Roles und RoleBindings}
Ermöglicht die Verwaltung von Berechtigungen innerhalb von Namespaces. Roles definieren die Berechtigungen für Ressourcen innerhalb eines Namespaces, während RoleBindings diese Rollen an Benutzer, Gruppen oder ServiceAccounts binden.\\

\noindent
\begin{tabularx}{\textwidth}{|X|X|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get roles} & Alle Roles im aktuellen Namespace auflisten \\
\texttt{kubectl get rolebindings} & Alle RoleBindings im aktuellen Namespace auflisten \\
\texttt{kubectl describe role <role-name>} & Details zu einer Role anzeigen \\
\texttt{kubectl describe rolebinding <rolebinding-name>} & Details zu einer RoleBinding anzeigen \\
\texttt{kubectl create -f role.yaml} & Rolle erstellen\\
\texttt{kubectl apply -f role.yaml} & Rolle erstellen oder aktualisieren\\
\texttt{kubectl create -f rolebinding.yaml} & RoleBinding erstellen\\
\texttt{kubectl apply -f rolebinding.yaml} & RoleBinding erstellen, oder aktualisieren\\
\texttt{kubectl delete role <role-name>} & Rolle löschen \\
\texttt{kubectl delete rolebinding <rolebinding-name>} & RoleBinding löschen \\
\hline
\end{tabularx}

\subsubsection{Konfiguration für eine Role}
\input{minted/tex/YAML-role.tex}

\subsubsection{Konfiguration für ein RoleBinding}
\input{minted/tex/YAML-rolebinding.tex}

\newpage
\subsection{Anwendungsfälle für Roles und RoleBindings}
\begin{itemize}
    \item Beschränken des Zugriffs auf bestimmte Ressourcen innerhalb eines Namespaces.
    \item Delegieren von Verwaltungsaufgaben an bestimmte Benutzer oder ServiceAccounts.
    \item Implementieren von Least Privilege Prinzipien, um die Sicherheit zu erhöhen.
\end{itemize}

\subsection{Best Practices für Roles und RoleBindings}
\begin{itemize}
    \item spezifische Rollen mit minimalen Berechtigungen verwenden, um das Prinzip der minimalen Rechte zu gewährleisten.
    \item alle RoleBindings und deren Zweck dokumentieren, um die Verwaltung zu erleichtern.
    \item regelmäßig die vergebenen Berechtigungen überwachen und überprüfen, um sicherzustellen, dass sie noch notwendig sind.
    \item Gruppen nutzen, um Berechtigungen effizienter zu verwalten.
\end{itemize}

\subsection{Weitere nützliche Befehle für Roles und RoleBindings}
\begin{tabular}{|p{0.68\textwidth}|p{0.32\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get roles -o yaml} & Konfiguration aller Roles \\
\texttt{kubectl get rolebindings -o yaml} & Konfiguration aller RoleBindings \\
\texttt{kubectl auth can-i <verb> <resource>} & Berechtigung Prüfen \\
\texttt{kubectl create role <role-name> --verb=<verb> --resource=<resource>} & Role erstellen \\
\texttt{kubectl create rolebinding <rolebinding-name> --role=<role-name> --user=<user-name>} & RoleBinding erstellen \\
\hline
\end{tabular}

\subsection*{Nützliche Links und Ressourcen}
Kubernetes RBAC Dokumentation:\\
\url{https://kubernetes.io/docs/reference/access-authn-authz/rbac/}\\
Kubernetes Task: Configuring Service Accounts for Pods:\\
\url{https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/}\\
Kubernetes Blog: Using RBAC for Kubernetes Authorization:\\
\url{https://kubernetes.io/blog/2017/10/using-rbac-generally-available-18/}\\

\newpage

\section{ClusterRoles und ClusterRoleBindings}
Ermöglicht die Verwaltung von Cluster-weiten Berechtigungen. ClusterRoles definieren die Berechtigungen für Ressourcen im gesamten Cluster, während ClusterRoleBindings diese Rollen an Benutzer, Gruppen oder ServiceAccounts im gesamten Cluster binden.\\

\noindent
\begin{tabular}{|p{0.68\textwidth}|p{0.32\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get clusterroles} & ClusterRoles auflisten \\
\texttt{kubectl get clusterrolebindings} & ClusterRoleBindings auflisten \\
\texttt{kubectl describe clusterrole <clusterrole-name>} & Details zu ClusterRole \\
\texttt{kubectl describe clusterrolebinding <clusterrolebinding-name>} & Details zu ClusterRoleBinding\\
\texttt{kubectl create -f clusterrole.yaml} & ClusterRole erstellen\\
\texttt{kubectl apply -f clusterrole.yaml} & ClusterRole aktualisieren\\
\texttt{kubectl create -f clusterrolebinding.yaml} & ClusterRoleBinding erstellen\\
\texttt{kubectl apply -f clusterrolebinding.yaml} & ClusterRoleBinding aktualisieren\\
\texttt{kubectl delete clusterrole <clusterrole-name>} & ClusterRole löschen \\
\texttt{kubectl delete clusterrolebinding <clusterrolebinding-name>} & ClusterRoleBinding löschen \\
\hline
\end{tabular}

\subsubsection{Konfiguration für eine ClusterRole}
\input{minted/tex/YAML-clusterrole.tex}

\subsubsection{Konfiguration für ein ClusterRoleBinding}
\input{minted/tex/YAML-clusterrolebinding.tex}

\subsection{Anwendungsfälle für ClusterRoles und ClusterRoleBindings}
\begin{itemize}
    \item Zuweisen von administrativen Berechtigungen für Cluster-weite Operationen.
    \item Delegieren von Berechtigungen für spezifische Cluster-weite Aufgaben an bestimmte Benutzer oder ServiceAccounts.
    \item Implementieren von Sicherheitsrichtlinien auf Cluster-Ebene.
\end{itemize}
\newpage
\subsection{Best Practices für ClusterRoles und ClusterRoleBindings}
\begin{itemize}
    \item spezifische Rollen mit minimalen Berechtigungen verwenden, um das Prinzip der minimalen Rechte zu gewährleisten.
    \item alle ClusterRoleBindings und deren Zweck dokumentieren, um die Verwaltung zu erleichtern.
    \item regelmäßig die vergebenen Berechtigungen überwachen und überprüfen, um sicherzustellen, dass sie noch notwendig sind.
    \item Gruppen nutzen, um Berechtigungen effizienter zu verwalten.
    \item Namenskonventionen für ClusterRoles und ClusterRoleBindings verwenden, um ihre Zwecke klar zu kommunizieren.
\end{itemize}

\subsection{Weitere nützliche Befehle für ClusterRoles und ClusterRoleBindings}
\begin{tabular}{
|p{0.61\textwidth}|p{0.39\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get clusterroles -o yaml} & Konfiguration aller ClusterRoles \\
\texttt{kubectl get clusterrolebindings -o yaml} & Konfiguration aller ClusterRoleBindings \\
\texttt{kubectl auth can-i <verb> <resource> --all-namespaces} & Rechte prüfen \\
\texttt{kubectl create clusterrole <clusterrole-name> --verb=<verb> --resource=<resource>} & ClusterRole erstellen \\
\texttt{kubectl create clusterrolebinding <clusterrolebinding-name> --clusterrole=<clusterrole-name> --user=<user-name>} & ClusterRoleBinding erstellen \\
\hline
\end{tabular}

\subsection*{Nützliche Links und Ressourcen}
RBAC Dokumentation: \url{https://kubernetes.io/docs/reference/access-authn-authz/rbac/}\\
Task: Configuring Service Accounts for Pods:\\
\url{https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/}\\
Using RBAC: \url{https://kubernetes.io/blog/2017/10/using-rbac-generally-available-18/}\\


\section{ServiceAccounts}
ServiceAccounts werden verwendet, um Pods mit bestimmten Berechtigungen auszustatten. Sie ermöglichen Pods den Zugriff auf den Kubernetes API-Server und andere Ressourcen unter Verwendung von Role-Based Access Control (RBAC).\\

\noindent
\begin{tabular}{
|p{0.7\textwidth}|p{0.3\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get serviceaccounts} & ServiceAccounts auflisten \\
\texttt{kubectl describe serviceaccount <serviceaccount-name>} & Details anzeigen \\
\texttt{kubectl create serviceaccount <serviceaccount-name>} & ServiceAccount erstellen \\
\texttt{kubectl apply -f serviceaccount.yaml} & Aus Datei aktualisieren\\
\texttt{kubectl delete serviceaccount <serviceaccount-name>} & ServiceAccount löschen \\
\hline
\end{tabular}

\subsubsection{Konfiguration für einen ServiceAccount}
\input{minted/tex/YAML-serviceaccount.tex}

\subsection{Anwendungsfälle für ServiceAccounts}
\begin{itemize}
    \item Ermöglichen von Pods, sich gegenüber dem Kubernetes API-Server zu authentifizieren.
    \item Zuweisen spezifischer Berechtigungen zu Pods mittels RBAC.
    \item Isolieren von Pods und deren Berechtigungen, um das Prinzip der minimalen Rechte zu gewährleisten.
    \item Implementieren von Sicherheitsrichtlinien, um den Zugriff von Pods auf Cluster-Ressourcen zu steuern.
\end{itemize}

\subsection{Best Practices für ServiceAccounts}
\begin{itemize}
    \item Spezifische ServiceAccounts für verschiedene Anwendungen oder Pods erstellen, anstatt den Standard-ServiceAccount zu verwenden.
    \item RoleBindings oder ClusterRoleBindings verwenden, um die Berechtigungen für ServiceAccounts zu steuern.
    \item Regelmäßig die vergebenen Berechtigungen überprüfen, um sicherzustellen, dass sie noch notwendig sind.
    \item Alle ServiceAccounts und deren Zweck dokumentieren, um die Verwaltung zu erleichtern.
    \item Namenskonventionen für ServiceAccounts nutzen, um ihre Zwecke klar zu kommunizieren.
\end{itemize}

%TODO: Fix Table
\subsection{Weitere nützliche Befehle für ServiceAccounts}
\begin{tabular}{|p{0.69\textwidth}|p{0.3\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get serviceaccounts -o yaml} & Konfiguration anzeigen \\
\texttt{kubectl patch serviceaccount <serviceaccount-name> -p <patch-data>} & Patch anwenden \\
\texttt{kubectl get secret <secret-name> -o yaml} & Secret anzeigen \\
\texttt{kubectl describe secret <secret-name>} & Details zu Secret\\
\texttt{kubectl create rolebinding <rolebinding-name> --role=<role-name> --serviceaccount=<namespace>:<serviceaccount-name>} & RoleBinding erstellen \\
\texttt{kubectl create clusterrolebinding <clusterrolebinding-name> --clusterrole=<clusterrole-name> --serviceaccount=<namespace>:<serviceaccount-name>} & ClusterRoleBinding erstellen \\
\hline
\end{tabular}
\newpage
\subsection{Komplettbeispiel}
\input{minted/tex/YAML-sicherheit-komplettbeispiel.tex}
\subsection*{Nützliche Links und Ressourcen}
Kubernetes Task: Configuring Service Accounts for Pods:\\
\url{https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/}\\
Kubernetes ServiceAccounts Administration:\\
\url{https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/}\\
Kubernetes Blog: Security Best Practices for Kubernetes Deployment:\\
\url{https://kubernetes.io/blog/2016/08/security-best-practices-kubernetes-deployment/}\\



\newpage

\section{Network Policies}
Network Policies ermöglichen die Kontrolle des Datenverkehrs zwischen Pods und anderen Netzwerkendpunkten auf Basis von Label-Selektoren und Regeln. Sie bieten eine Möglichkeit, den ein- und ausgehenden Datenverkehr zu regulieren, um die Sicherheit und Isolation im Cluster zu erhöhen. \\

\noindent
\begin{tabular}{
|p{0.7\textwidth}|p{0.3\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get networkpolicies} & Network Policies auflisten \\
\texttt{kubectl describe networkpolicy <policy-name>} & Details  anzeigen \\
\texttt{kubectl create -f <networkpolicy.yaml>} & Network Policy erstellen \\
\texttt{kubectl apply -f <networkpolicy.yaml>} & Network Policy aktualisieren\\
\texttt{kubectl delete networkpolicy <policy-name>} & Network Policy löschen \\
\texttt{kubectl edit networkpolicy <policy-name>} & Network Policy bearbeiten \\
\texttt{kubectl get networkpolicy <policy-name> -o yaml} & Network Policy anzeigen \\
\hline
\end{tabular}

\subsubsection{Konfiguration für eine Network Policy}
\input{minted/tex/YAML-network-policy.tex}
\newpage
\subsection{Anwendungsfälle für Network Policies}
\begin{itemize}
    \item Isolieren von Pods, um sicherzustellen, dass nur autorisierter Datenverkehr zugelassen wird.
    \item Schutz sensibler Datenbanken, indem der Zugriff nur auf spezifische Pods beschränkt wird.
    \item Implementieren von Sicherheitsrichtlinien, um unautorisierten Datenverkehr zu verhindern.
    \item Erzwingen von Kommunikationsmustern zwischen verschiedenen Anwendungskomponenten.
\end{itemize}

\subsection{Best Practices für Network Policies}
\begin{itemize}
    \item Beginne mit restriktiven Policies und erweitere schrittweise die erlaubten Verbindungen.
    \item Nutze Label-Selektoren, um granularere Kontrollen über den Datenverkehr zu erlangen.
    \item Überprüfe und teste regelmäßig die Network Policies, um sicherzustellen, dass sie die gewünschten Sicherheitsanforderungen erfüllen.
    \item Dokumentiere alle Network Policies und deren Zweck, um die Verwaltung zu erleichtern.
    \item Nutze Namespaces, um Network Policies auf bestimmte Bereiche des Clusters zu beschränken.
\end{itemize}

\subsection{Weitere nützliche Befehle für Network Policies}
\begin{tabular}{|p{0.53\textwidth}|p{0.47\textwidth}|}
\hline
\textbf{Befehl} & \textbf{Beschreibung} \\
\hline
\texttt{kubectl get networkpolicies -o yaml} & YAML-Konfiguration aller Network Policies im aktuellen Namespace anzeigen \\
\texttt{kubectl patch networkpolicy <policy-name> -p <patch-data>} & Einen Patch auf eine Network Policy anwenden \\
\texttt{kubectl label pod <pod-name> <label-key>=<label-value>} & Ein Label zu einem Pod hinzufügen, um die Network Policy anzuwenden \\
\texttt{kubectl annotate networkpolicy <policy-name> <annotation-key>=<annotation-value>} & Eine Annotation zu einer Network Policy hinzufügen \\
\texttt{kubectl get pods --selector=<label-selector>} & Alle Pods mit einem bestimmten Label-Selektor auflisten \\
\hline
\end{tabular}

\subsection{Nützliche Links und Ressourcen}
Kubernetes Network Policies Dokumentation:\\
\url{https://kubernetes.io/docs/concepts/services-networking/network-policies/}\\
Kubernetes Task: Declare Network Policy:\\
\url{https://kubernetes.io/docs/tasks/administer-cluster/declare-network-policy/}\\
Kubernetes Network Policy Recipes auf GitHub:\\
\url{https://github.com/ahmetb/kubernetes-network-policy-recipes}\\